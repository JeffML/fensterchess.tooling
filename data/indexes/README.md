# Data Indexes

This directory contains all game data and indexes for the fensterchess master games database.

## Source of Truth: Netlify Blobs

**All files in this directory are sourced from Netlify Blobs** - they are NOT stored in git.

### Workflow

1. **Download from blobs**: `npm run backup` (downloads to backups/, or can copy to here)
2. **Generate new data**: `npm run download:pgnmentor` (incremental updates)
3. **Rebuild indexes**: `npm run build-indexes` (regenerates search indexes)
4. **Upload to blobs**: `npm run upload` (pushes changes back to production)

## File Types

### Data Files (Chunks)
- `chunk-*.json` - Game data, ~4000 games per chunk (~4-5 MB each)
- Created by download scripts, appended incrementally

### Search Indexes
- `opening-by-fen.json` - Position lookup
- `opening-by-name.json` - Opening name lookup
- `opening-by-eco.json` - ECO code lookup
- `player-index.json` - Player name lookup
- `event-index.json` - Event/tournament lookup
- `date-index.json` - Date range lookup
- `game-to-players.json` - Lightweight player array
- `ancestor-to-descendants.json` - Position navigation tree
- `eco-roots.json` - ECO category data

**Note:** All search indexes are regenerated by `buildIndexes.ts` - do not edit manually.

### Operational State
- `deduplication-index.json` - Hash â†’ game index mapping (prevents duplicates)
- `source-tracking.json` - Download history and file metadata
- `master-index.json` - Complete game metadata (legacy, may be deprecated)

**Note:** Operational state files are updated by download scripts and uploaded to blobs.

## Local Development

All files in this directory are gitignored. To work locally:

1. Run `npm run backup` to download current production data
2. Copy from `backups/<timestamp>/indexes/*` to `data/indexes/` if needed
3. Or let download/build scripts create them as needed

## Storage

- **Production**: Netlify Blobs (`master-games` store, `indexes/` prefix)
- **Backup**: `backups/<timestamp>/indexes/` (gitignored, timestamped)
- **Local**: `data/indexes/` (gitignored, working directory)
- **Git**: Nothing - all data files excluded

Total size: ~25-40 MB depending on game count
